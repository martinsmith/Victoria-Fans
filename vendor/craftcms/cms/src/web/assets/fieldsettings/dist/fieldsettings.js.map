{"version":3,"file":"fieldsettings.js","mappings":"YAAA,IAAWA,IA0FRC,OAvFDC,MAAMC,oBAAsBC,QAAQC,KAAKC,OACvC,CACEC,QAAS,KACTC,WAAY,KACZC,UAAW,KACXC,YAAa,KAEbC,aAAc,KACdC,sBAAsB,EAEtBC,KAAM,SAAUC,EAAQC,EAAWN,EAAWO,GAC5CC,KAAKV,QAAUP,EAAEc,GACjBG,KAAKT,WAAaR,EAAEe,GACpBE,KAAKR,UAAYA,EACjBQ,KAAKP,YAAcO,KAAKV,QAAQW,MAChCD,KAAKE,YAAYH,EAAUd,MAAMC,oBAAoBiB,UACrDH,KAAKI,YAAYJ,KAAKV,QAAS,SAAU,qBAC3C,EAEAe,mBAAoB,WAAY,IAAAC,EAAA,KAE1BN,KAAKN,eACPM,KAAKL,sBAAuB,EAC5BK,KAAKN,aAAaa,SAClBpB,QAAQqB,uBAAsB,WAC5BF,EAAKX,sBAAuB,CAC9B,KAGF,IAAMc,EAAUT,KAAKP,YACfM,EAAWhB,EAAE,WAChB2B,OAAOV,KAAKT,WAAWoB,SACvBC,YAEHZ,KAAKP,YAAcO,KAAKV,QAAQW,MAGhCD,KAAKT,WAAWsB,KACd,wDAIFb,KAAKN,aAAeoB,MAAMC,YAAYC,SAEtC,IAAIC,EAAO,CACTC,KAAMlB,KAAKP,YACXgB,QAAAA,EACAV,SAAAA,GAEEC,KAAKR,YACPyB,EAAKzB,UAAYQ,KAAKR,UAAU2B,QAC9B,YACAnB,KAAKP,aAEPwB,EAAKG,aAAepB,KAAKR,UAAU2B,QAAQ,YAAaV,IAG1DxB,MAAMoC,kBAAkB,OAAQ,yBAA0B,CACxDC,YAAatB,KAAKN,aAAa6B,MAC/BN,KAAMA,IAELO,MAAK,SAACC,GACL,IAAIC,EAAY3C,EAAE0C,EAASR,KAAKU,cAAgB,IAC5CrB,EAAKP,SAAS6B,uBAChBF,EAAY3C,EAAE,SAAU,CACtB8C,GAAI5C,MAAM6C,cAAcxB,EAAKb,eAC5BiB,OAAOgB,IAEZpB,EAAKf,WAAWsB,KAAK,IAAIH,OAAOgB,GAChCzC,MAAM8C,eAAezB,EAAKf,YAC1BN,MAAM+C,eAAeP,EAASR,KAAKgB,UACnChD,MAAMiD,eAAeT,EAASR,KAAKkB,SACrC,IAAE,OACK,SAACC,GAC0B,IAAAC,EAA3B/B,EAAKX,uBACRV,MAAMqD,GAAGC,aAAaH,SAAW,QAAVC,EAADD,EAAGX,gBAAQ,IAAAY,GAAM,QAANA,EAAXA,EAAapB,YAAI,IAAAoB,OAAA,EAAjBA,EAAmBG,SACzClC,EAAKf,WAAWsB,KAAK,IAEzB,GACJ,GAEF,CACEV,SAAU,CACRyB,sBAAsB,I","sources":["webpack:///./fieldsettings.js"],"sourcesContent":["(function ($) {\n  /** global: Craft */\n  /** global: Garnish */\n  Craft.FieldSettingsToggle = Garnish.Base.extend(\n    {\n      $toggle: null,\n      $container: null,\n      namespace: null,\n      currentType: null,\n\n      _cancelToken: null,\n      _ignoreFailedRequest: false,\n\n      init: function (toggle, container, namespace, settings) {\n        this.$toggle = $(toggle);\n        this.$container = $(container);\n        this.namespace = namespace;\n        this.currentType = this.$toggle.val();\n        this.setSettings(settings, Craft.FieldSettingsToggle.defaults);\n        this.addListener(this.$toggle, 'change', 'handleToggleChange');\n      },\n\n      handleToggleChange: function () {\n        // Cancel the current request\n        if (this._cancelToken) {\n          this._ignoreFailedRequest = true;\n          this._cancelToken.cancel();\n          Garnish.requestAnimationFrame(() => {\n            this._ignoreFailedRequest = false;\n          });\n        }\n\n        const oldType = this.currentType;\n        const settings = $('<form/>')\n          .append(this.$container.clone())\n          .serialize();\n\n        this.currentType = this.$toggle.val();\n\n        // Show a spinner\n        this.$container.html(\n          '<div class=\"zilch\"><div class=\"spinner\"></div></div>'\n        );\n\n        // Create a cancel token\n        this._cancelToken = axios.CancelToken.source();\n\n        let data = {\n          type: this.currentType,\n          oldType,\n          settings,\n        };\n        if (this.namespace) {\n          data.namespace = this.namespace.replace(\n            /__TYPE__/g,\n            this.currentType\n          );\n          data.oldNamespace = this.namespace.replace(/__TYPE__/g, oldType);\n        }\n\n        Craft.sendActionRequest('POST', 'fields/render-settings', {\n          cancelToken: this._cancelToken.token,\n          data: data,\n        })\n          .then((response) => {\n            let $settings = $(response.data.settingsHtml || '');\n            if (this.settings.wrapWithTypeClassDiv) {\n              $settings = $('<div/>', {\n                id: Craft.formatInputId(this.currentType),\n              }).append($settings);\n            }\n            this.$container.html('').append($settings);\n            Craft.initUiElements(this.$container);\n            Craft.appendHeadHtml(response.data.headHtml);\n            Craft.appendBodyHtml(response.data.bodyHtml);\n          })\n          .catch((e) => {\n            if (!this._ignoreFailedRequest) {\n              Craft.cp.displayError(e?.response?.data?.message);\n              this.$container.html('');\n            }\n          });\n      },\n    },\n    {\n      defaults: {\n        wrapWithTypeClassDiv: false,\n      },\n    }\n  );\n})(jQuery);\n"],"names":["$","jQuery","Craft","FieldSettingsToggle","Garnish","Base","extend","$toggle","$container","namespace","currentType","_cancelToken","_ignoreFailedRequest","init","toggle","container","settings","this","val","setSettings","defaults","addListener","handleToggleChange","_this","cancel","requestAnimationFrame","oldType","append","clone","serialize","html","axios","CancelToken","source","data","type","replace","oldNamespace","sendActionRequest","cancelToken","token","then","response","$settings","settingsHtml","wrapWithTypeClassDiv","id","formatInputId","initUiElements","appendHeadHtml","headHtml","appendBodyHtml","bodyHtml","e","_e$response","cp","displayError","message"],"sourceRoot":""}